# 해외 주식 데이터 수집 및 처리 지침 (해외주식_데이터수집_지침.md)

본 문서는 프로젝트에서 사용하는 해외 주식 데이터(미국 주식, ETF 등)의 수집 방법, 주기, 저장 규칙을 정의합니다. 모든 개발 및 데이터 로직 구현 시 본 지침을 **최우선**으로 따릅니다.

## 1. 데이터 소스 (Source of Truth)
*   **실시간 및 단기 데이터 (Real-time & 5m Bars)**
    *   **Primary Source**: **한국투자증권 (KIS) API**
    *   **대상 종목**: **SOXL, SOXS, UPRO** (핵심 레버리지/인버스 ETF) 및 주요 감시 종목
    *   **수집 항목**:
        *   실시간 현재가 (Live Price)
        *   5분봉 데이터 (5-minute Candles)
    *   **이유**: `yfinance`의 지연(15분 이상)을 방지하고 정확한 실시간 체결가와 호가를 반영하기 위함.
*   **보조 및 장기 데이터 (Historical & Market Indices)**
    *   **Secondary Source**: `yfinance`
    *   **대상**: S&P500, NASDAQ 등 시장 지수 및 장기 일봉 분석용.
    *   **용도**: KIS API 호출 한계 시 백업 또는 장기 추세 분석용.

## 2. 거래 시간 및 데이터 범위 (Market Hours)
*   **모든 시간대 포함 (Extended Hours)**:
    *   데이터 수집 및 분석 시 **정규장(Regular Market)** 뿐만 아니라 **프리마켓(Pre-market)** 및 **애프터마켓(After-market)** 데이터를 **반드시 포함**해야 합니다.
    *   변동성이 큰 레버리지 상품 특성상 장전/장후 거래량이 중요하므로 이를 누락하지 않도록 주의합니다.
*   **타임존**: 데이터 처리는 UTC/EST 로직을 따르되, 최종 사용자 표시는 **KST(한국 시간)** 기준으로 통일합니다.

## 3. 데이터 저장 및 관리 (Database Persistence)
*   **DB 저장 원칙**:
    *   자주 조회되거나 재사용되는 데이터는 단순 메모리 캐싱(RAM)을 넘어 **데이터베이스(DB)**에 저장하여 영속성을 확보합니다.
    *   **저장 대상**:
        *   수집된 5분봉 히스토리 (중복 호출 방지 및 과거 패턴 분석용)
        *   생성된 매매 신호(Signal) 및 분석 결과
        *   주요 지지/저항선 계산 값
    *   **활용**: 서버 재시작 시에도 이전 데이터를 불러와 연속적인 분석이 가능하도록 구현합니다.

## 4. 데이터 수집 주기 (Frequency)
*   **실시간 감시**: 중요 종목(SOXL, SOXS, UPRO)은 **1분(60초)** 단위 갱신을 원칙으로 하되, API Rate Limit을 고려하여 조정합니다.
*   **DB 동기화**: 수집된 실시간 데이터는 즉시 또는 주기적으로 DB에 적재(Upsert)하여 최신 상태를 유지합니다.

## 5. 종목 리스트 관리
*   **핵심 감시 종목**: `SOXL`, `SOXS`, `UPRO`
*   **추가 감시 가능**: `TSLA`, `TQQQ`, `SQQQ` (필요시 KIS API 적용 확장)
