## 0. [최우선] 작업 수행 및 소통 절차 ⚠️ (절대 준수)
> **모든 작업은 사용자의 승인 없이는 진행하지 않습니다.**

1. **선보고 후실행 (Plan First, Execute Later)**
   - 지시를 받으면 즉시 코드를 수정하거나 실행하지 않습니다.
   - 반드시 **작업 계획(Plan)과 진행 방향**을 먼저 사용자에게 설명합니다.
   - 사용자의 **확인 및 승인(OK)**이 떨어진 후에만 작업을 진행합니다.

2. **브라우저 제어 사전 승인**
   - 브라우저 제어(스크린샷, 클릭 등)는 **정말 복잡하거나 필수적인 경우**에만 제한적으로 사용합니다.
   - 사용이 필요한 경우, **반드시 사용자에게 먼저 필요성을 설명하고 허락을 구한 뒤** 실행합니다.

---

## 1. 브라우저 제어 규칙 ⚠️

> **브라우저 제어는 쿼터를 많이 소모합니다. 필수적인 경우에만 사용합니다.**
> **사용 전 반드시 사용자의 허락을 받으세요.**

### 테스트 환경 및 접속 정보
- **URL (우선)**: `http://localhost:9100/` (프론트엔드 재시작 후 사용)
- **URL (대체)**: `http://money.mysmartgate.kr/` (로컬 접속 불가 시 최후의 수단)
- **테스트 계정**: `leeyw94@naver.com` / `0000`

### 사용 제한
- **사용자 승인 필수**: 브라우저 제어 도구 사용 전 반드시 목적을 설명하고 허락을 구함
- 코드 수정 후 빌드 성공 여부는 터미널 출력으로 확인
- UI 변경 확인이 꼭 필요할 때만 스크린샷 캡처
- 반복적인 브라우저 접속/테스트 자제

### 쿼터 관리
- 쿼터가 **10% 이하** 또는 **10분 전**에 사용자에게 알림
- 브라우저 테스트 대신 사용자에게 수동 확인 요청 우선

---

## 2. 개발 및 수정 원칙 ⚠️ (필독)

### 1. 임의 수정 금지
- 사용자에게 묻지 않고 마음대로 코드를 수정하지 않는다.
- 기존 소스 코드를 최대한 유지하며, 꼭 필요한 부분만 신중하게 수정한다.

### 2. 에러 방지
- 수정 후 빌드 에러나 런타임 에러가 발생하지 않도록 철저히 확인한다.
- 불필요한 코드 변경으로 인한 사이드 이펙트를 경계한다.

### 3. 데이터베이스(DB) 변경 시 사전 승인 필수
- 테이블 생성(CREATE), 구조 변경(ALTER), 삭제(DROP) 등 모든 스키마 변경 작업은 **반드시 사용자에게 먼저 물어보고 승인을 받은 후** 진행한다.
- 임의로 DB 구조를 변경하는 것은 엄격히 금지된다.

### 4. 소스 수정 및 추가 할 경우에는 반드시 상세 주석을 추가 한다. 시간 및 버전 포함
---

## 3. 핵심 아키텍처 원칙

### 데이터 단일 소스 (Single Source of Truth)
| 데이터 | 소스 테이블 |
|--------|-------------|
| 가격, 등락률 | `market_indices` |
| 매수 신호 상태 | `buy_stock` |
| 매도 신호 상태 | `sell_stock` |

### Primary Key
- **모든 API/DB 작업은 `ticker`를 기준으로 함**
- `manage_id`는 더 이상 사용하지 않음

### 로깅 및 데이터베이스 전략 (Logging & DB Strategy)
| 테이블 | 용도 | 갱신 주기 | 정책 |
|--------|------|-----------|------|
| `market_indicators_snapshot` | **실시간 대시보드용** 최신 상태 유지 | **1분** (실시간) | Ticker별 1행 유지 (UPSERT) |
| `market_indicators_history` | **백테스팅/분석용** 이력 저장 | **10분** (Throttle) | 10분 간격으로 Append (INSERT) |

---

## 3. 버전 관리

- 버전: `frontend/package.json`의 version 필드
- 배포 시 버전을 한 단계씩 증가 (3.6.1 → 3.6.2)
- CHANGELOG.md는 사용하지 않음

---

## 4. 배포 절차

```bash
# 1. Frontend 빌드
cd frontend && npm run build

# 2. Nginx 재시작
echo 'blueeye0037!' | sudo -S systemctl restart nginx

# 3. Backend 재시작 (필요시)
echo 'blueeye0037!' | sudo -S systemctl restart cheongan-backend
```

---

## 5. MASTER CONTROL TOWER 관련

자세한 내용은 [04_MASTER_CONTROL_TOWER.md](file:///home/blue/blue/my_project/money/필수지침/개발지침/04_MASTER_CONTROL_TOWER.md) 참조
