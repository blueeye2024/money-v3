# ì‹ í˜¸í¬ì°© ì‹œìŠ¤í…œ êµ¬í˜„ì§€ì¹¨ (Ver 3.5)

**ë¬¸ì„œ ë²„ì „**: 3.5.1  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-01-08  
**ë‹´ë‹¹ ì‹œìŠ¤í…œ**: ì‹¤ì‹œê°„ ì‹ í˜¸ í¬ì°© & ì•Œë¦¼ ë‚´ì—­

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì‹ í˜¸ ë°œìƒ íˆìŠ¤í† ë¦¬](#ì‹ í˜¸-ë°œìƒ-íˆìŠ¤í† ë¦¬)
3. [ë¬¸ì ë°œì†¡ ì‹œìŠ¤í…œ](#ë¬¸ì-ë°œì†¡-ì‹œìŠ¤í…œ)
4. [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°](#ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì¡°)
5. [UI ì»´í¬ë„ŒíŠ¸](#ui-ì»´í¬ë„ŒíŠ¸)
6. [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)

---

## ì‹œìŠ¤í…œ ê°œìš”

### í•µì‹¬ ê¸°ëŠ¥
ì‹ í˜¸í¬ì°© ì‹œìŠ¤í…œì€ **MASTER CONTROL TOWER**ì—ì„œ ë°œìƒí•œ ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ë¥¼ ê¸°ë¡í•˜ê³ , SMS ì•Œë¦¼ì„ ë°œì†¡í•©ë‹ˆë‹¤.
Ver 3.5ë¶€í„° **ëˆ„ì  ì‹ í˜¸ ë‹¬ì„±(Cumulative Signal Completion)** ë° **ë’·ë¶ ê°ì§€(Catch-up)** ë¡œì§ì´ ì ìš©ë˜ì–´, ì‹ í˜¸ì˜ ëˆ„ë½ ì—†ì´ ì •í™•í•œ ë§¤ë§¤ íƒ€ì´ë°ì„ í¬ì°©í•©ë‹ˆë‹¤.

### ì£¼ìš” êµ¬ì„±ìš”ì†Œ
1. **ì‹ í˜¸ ë°œìƒ íˆìŠ¤í† ë¦¬**: ìë™ íƒì§€ëœ ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ ê¸°ë¡
2. **ë¬¸ì ë°œì†¡ íˆìŠ¤í† ë¦¬**: SMS ë°œì†¡ ë‚´ì—­ ë° ìƒíƒœ
3. **SMS ì „ì²´ ê°€ë™**: ë¬¸ì ë°œì†¡ ON/OFF ì œì–´

### ë°ì´í„° íë¦„
```
MASTER CONTROL TOWER (ì‹ í˜¸ ë¶„ì„)
    â†“
1ì°¨(5ë¶„)/2ì°¨(ë°•ìŠ¤)/3ì°¨(30ë¶„) ê°œë³„ ë‹¬ì„± ì‹œ DB ê¸°ë¡ (Latched)
    â†“
3ê°€ì§€ ì‹ í˜¸ ëª¨ë‘ ë‹¬ì„± í™•ì¸ (ìˆœì„œ ë¬´ê´€, ëˆ„ì  ì²´í¬)
    â†“
'ìµœì¢… ë§¤ìˆ˜ ì™„ë£Œ(Final)' DB ê¸°ë¡ & SMS ë°œì†¡ (ë§¤ë„ ëª¨ë“œ ì „í™˜)
    â†“
3ì°¨ ì²­ì‚°(30ë¶„ DC) ë°œìƒ ì‹œ 'ìµœì¢… ì²­ì‚° ì™„ë£Œ' ê¸°ë¡ (ë§¤ìˆ˜ ëª¨ë“œ ë³µê·€)
```

---

## ì‹ í˜¸ ë°œìƒ íˆìŠ¤í† ë¦¬

### ì €ì¥ ì¡°ê±´ (Logic Ver 3.5)

#### 1. ìµœì¢… ì§„ì… (Final Buy) í™•ì • ë¡œì§
ê¸°ì¡´ì˜ "ë™ì‹œ ë§Œì¡±" ì¡°ê±´ì—ì„œ "ëˆ„ì  ë‹¬ì„±(Latched Logic)" ì¡°ê±´ìœ¼ë¡œ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤. ë˜í•œ, 30ë¶„ë´‰/5ë¶„ë´‰ì˜ ê³¨ë“ í¬ë¡œìŠ¤ ì‹œì ì„ ë†“ì³ë„ **ì´ë¯¸ ì •ë°°ì—´(Trend Up) ìƒíƒœ**ë¼ë©´ ì‹ í˜¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤(Catch-up Logic).

```python
# backend/analysis.py

# 1, 2, 3ì°¨ ì‹ í˜¸ê°€ DBì— ëª¨ë‘ 'Y'ë¡œ ê¸°ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
all_met = (state.get("buy_sig1_yn") == 'Y' and 
           state.get("buy_sig2_yn") == 'Y' and 
           state.get("buy_sig3_yn") == 'Y')

if all_met and state.get("final_buy_yn") == 'N':
    # ìµœì¢… ì§„ì… í™•ì •
    save_v2_buy_signal(manage_id, 'final', current_price)
    # SMS ë°œì†¡ "ìµœì¢…ë§¤ìˆ˜(V2)"
```

#### 2. ì²­ì‚° ì‹ í˜¸ (Sell Signal) í™•ì • ë¡œì§
ë§¤ë„ ì‹ í˜¸ ì—­ì‹œ ë°ë“œí¬ë¡œìŠ¤ ë°œìƒ ì‹œì ë¿ë§Œ ì•„ë‹ˆë¼, **ì´ë¯¸ ì—­ë°°ì—´(Trend Down) ìƒíƒœ**ì¸ ê²½ìš°ì—ë„ ì‹ í˜¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.

- **1ì°¨(5ë¶„ DC)**: 5ë¶„ë´‰ ë°ë“œí¬ë¡œìŠ¤ OR 5ë¶„ë´‰ ì—­ë°°ì—´
- **3ì°¨(30ë¶„ DC)**: 30ë¶„ë´‰ ë°ë“œí¬ë¡œìŠ¤ OR 30ë¶„ë´‰ ì—­ë°°ì—´
- **ìµœì¢… ì²­ì‚°(Final Sell)**: 3ì°¨ ì²­ì‚°(30ë¶„ DC)ì´ ë°œìƒí•˜ë©´ ì¦‰ì‹œ ìµœì¢… ì²­ì‚°ìœ¼ë¡œ í™•ì •ë©ë‹ˆë‹¤.

```python
# 30m DC (Sig 3) ë°œìƒ ì‹œ
if save_v2_sell_signal(manage_id, 'sig3', curr_price):
    # ìë™ìœ¼ë¡œ Final Sell ì²˜ë¦¬
    save_v2_sell_signal(manage_id, 'final', curr_price)
```

#### 3. ì¤‘ë³µ ë°©ì§€
```python
# 30ë¶„ ì´ë‚´ ë™ì¼ ì¢…ëª© BUY ì‹ í˜¸ í™•ì¸
cursor.execute("""
    SELECT id FROM signal_history 
    WHERE ticker=%s AND signal_type='BUY (MASTER)' 
    AND created_at >= NOW() - INTERVAL 30 MINUTE 
    LIMIT 1
""", (ticker,))

if not cursor.fetchone():  # â† ì—†ìœ¼ë©´ ì €ì¥
    save_signal({...})
```

### í‘œì‹œ í˜•ì‹

#### í…Œì´ë¸” ì»¬ëŸ¼
| ì»¬ëŸ¼ | ë„ˆë¹„ | ì •ë ¬ | ì„¤ëª… |
|------|------|------|------|
| ë°œìƒ ì‹œê°„ | 160px | left | yyyy.MM.dd HH:mm (ì´ˆ ì œê±°) |
| ì¢…ëª© | 90px | left | SOXL, SOXS, UPRO |
| êµ¬ë¶„ | 90px | center | ë§¤ìˆ˜/ë§¤ë„/ê²½ë³´ (í•œê¸€) |
| ì‹ í˜¸ ì´ìœ  | auto | left | signal_reason ë˜ëŠ” interpretation |
| ì‹ í˜¸ê°€ | 110px | right | $XX.XX (ì†Œìˆ˜ì  2ìë¦¬) |
| í˜„ì¬ê°€ | 110px | right | $XX.XX (MASTER CONTROL TOWERì—ì„œ ê°€ì ¸ì˜´) |
| ìˆ˜ìµë¥  | 100px | center | +X.XX% (ê³„ì‚°) |
| ê´€ë¦¬ | 80px | center | ì‚­ì œ ë²„íŠ¼ |

#### êµ¬ë¶„ í‘œì‹œ
```javascript
// BUY/SELL íŒë‹¨
const isBuy = signalType.includes('BUY');
const isSell = signalType.includes('SELL');
const isWarning = signalType.includes('WARNING');

if (isBuy) {
    actionText = 'ë§¤ìˆ˜';
    // Red color
} else if (isSell) {
    actionText = 'ë§¤ë„';
    // Blue color
}
```

---

## ë¬¸ì ë°œì†¡ ì‹œìŠ¤í…œ

### ë¬¸ì ë°œì†¡ ì¡°ê±´
1. **SMS ì „ì²´ ê°€ë™ ON**
2. **ì‹ í˜¸ ë°œìƒ**: ì§„ì…(1ì°¨/2ì°¨/3ì°¨/ìµœì¢…), ê²½ë³´, ì²­ì‚°
3. **ì¤‘ë³µ ë°©ì§€**: 30ë¶„ ì´ë‚´ ë™ì¼ ìœ í˜• ë°œì†¡ ì œí•œ

---

## ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### signal_history í…Œì´ë¸”
```sql
CREATE TABLE signal_history (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ticker VARCHAR(10) NOT NULL,
    name VARCHAR(100),
    signal_type VARCHAR(50),           -- 'BUY (MASTER)', 'SELL', 'WARNING'
    signal_reason VARCHAR(100),        -- Ver 3.0: ì‹ í˜¸ ë°œìƒ ì´ìœ 
    position_desc VARCHAR(255),
    price DECIMAL(10, 2),
    signal_time DATETIME,
    time_kst VARCHAR(50),
    time_ny VARCHAR(50),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_sent BOOLEAN DEFAULT FALSE,
    score INT,
    interpretation VARCHAR(255)
);
```

### buy_stock / sell_stock í…Œì´ë¸” (V2)
ì‹¤ì‹œê°„ ìƒíƒœ ì¶”ì ì„ ìœ„í•œ í…Œì´ë¸”ì…ë‹ˆë‹¤.
- `buy_sig1_yn` ~ `buy_sig3_yn`: ê° ë‹¨ê³„ ë‹¬ì„± ì—¬ë¶€ (Y/N)
- `final_buy_yn`: ìµœì¢… ë§¤ìˆ˜ ì™„ë£Œ ì—¬ë¶€ (Y/N)
- `real_buy_yn`: ì‚¬ìš©ì ì‹¤ë§¤ìˆ˜ í™•ì • ì—¬ë¶€ (Y/N)

---
