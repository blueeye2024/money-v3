# 환경설정 가이드 (통합본)

> **⚠️ 최우선 필독**: 이 문서는 프로젝트의 핵심 환경설정 및 작업 규칙을 정의합니다.

---

## 🎯 핵심 원칙 (절대 준수)

### 1️⃣ 언어 사용 규칙
```
✅ 모든 설명, 응답, 주석은 한국어로 작성
✅ 코드 변수명/함수명은 영어 사용 (표준 준수)
✅ Git 커밋 메시지는 한국어로 작성
✅ 기술 용어는 한글(영문) 병기 가능 (예: 배포(Deploy))
```

### 2️⃣ MCP 서버 활용 규칙
```
✅ 모든 작업에 MCP 서버 자동 활용
✅ 코드 검색/분석: Context7 MCP
✅ 데이터베이스 작업: MySQL MCP
✅ 파일 읽기/쓰기: Filesystem MCP
✅ 서버 관리/명령: Shell MCP
✅ 복잡한 문제 분석: Sequential Thinking MCP
✅ HTTP 요청: Fetch MCP
✅ 컨텍스트 저장: Memory MCP
```

### 3️⃣ 작업 완료 후 필수 절차 (⭐ 매우 중요)
```
작업 완료 → Git 버전 업데이트 → 커밋 & 푸시 → 웹 배포 → 버전 업데이트 → 요청사항 기록
```

---

## 📦 표준 배포 프로세스

### 1단계: 버전 결정
- **Minor Update** (기능 추가, 버그 수정): 0.0.1 증가
  - 예: v3.2.1 → v3.2.2
- **Major Update** (대규모 변경): 0.1.0 증가
  - 예: v3.2.2 → v3.3.0

### 2단계: CHANGELOG 업데이트
**파일**: `/home/blue/blue/my_project/money/CHANGELOG.md`

```markdown
## [Ver 3.2.2] - 2026-01-04

### 추가 (Added)
- **기능 이름**: 상세 설명

### 수정 (Fixed)
- **버그/개선**: 상세 설명

### 변경 (Changed)
- **변경사항**: 상세 설명
```

**주의**: 최신 버전이 가장 위에 오도록 작성

### 3단계: Footer 버전 및 빌드 시간 업데이트
**파일**: `frontend/src/App.jsx` (또는 해당 레이아웃 파일)

```javascript
// Footer 영역 수정
<p>&copy; 2026 Stock Trading System. All rights reserved. Ver 3.2.2 (Build: 2026-01-04 18:45)</p>
```

**형식**:
- 버전: `Ver 3.2.2`
- 빌드 시간: 현재 한국 시간 `YYYY-MM-DD HH:mm`

### 4단계: Frontend 빌드
```bash
cd /home/blue/blue/my_project/money/frontend
npm run build
```

**검증**:
- `dist/` 디렉토리 생성 확인
- 빌드 시간 2-3초 내 완료
- 에러 없이 완료

### 5단계: Git 커밋 및 푸시
```bash
cd /home/blue/blue/my_project/money

# Stage all changes
git add -A

# Commit with version message (한국어)
git commit -m "[v3.2.2] 기능 추가: SOXL 신호 필터링

- Add: 신호 중복 제거 로직 추가
- Fix: 가격 업데이트 버그 수정
- Update: Footer 버전 v3.2.2 (Build: 2026-01-04 18:45)"

# Push to remote
git push origin main
```

**커밋 메시지 형식** (한국어):
- 제목: `[v3.2.2] 한 줄 요약`
- 본문: 변경사항 Bullet Point 형식

### 6단계: 웹 배포
```bash
cd /home/blue/blue/my_project/money
./deploy.sh

# 또는 alias 사용
web-run100
```

**배포 스크립트 내용** (`deploy.sh`):
```bash
#!/bin/bash
# Frontend 빌드 (이미 완료되어 있음)
# Backend 재시작
sudo systemctl restart money-backend
sudo systemctl restart money-frontend
echo "✅ 배포 완료!"
```

### 7단계: 요청사항 DB 등록
**방법 1: 웹 페이지 사용**
- URL: `http://localhost:5000/requests` (또는 배포 URL)
- 요청 내용, 구현 사항, 완료 시간 입력

**방법 2: API 직접 호출**
```bash
curl -X POST http://localhost:9100/api/requests \
  -H "Content-Type: application/json" \
  -d '{
    "request_text": "SOXL 신호 필터링 기능 추가",
    "ai_interpretation": "중복 신호 제거 및 필터링 로직 구현",
    "implementation_details": "backend/signal_filter.py 생성, db.py 수정, 테스트 완료",
    "status": "completed"
  }'
```

---

## 🤖 AI 에이전트 자동화 규칙

### 작업 완료 시 자동 실행 (필수)
코드 수정이 완료되면 **반드시 자동으로** 다음을 실행:

1. ✅ **버전 번호 결정** (기존 버전 +0.0.1)
2. ✅ **CHANGELOG.md 업데이트** (최상단에 새 버전 항목)
3. ✅ **Footer 버전 업데이트** (`frontend/src/App.jsx`)
4. ✅ **Frontend 빌드** (`npm run build`)
5. ✅ **Git 커밋 & 푸시** (위 형식 준수)
6. ✅ **웹 배포** (`./deploy.sh`)
7. ✅ **요청사항 DB 등록** (POST /api/requests)

**예외 사항**:
- 사용자가 명시적으로 "배포하지 마" 또는 "Git 업데이트 안 해도 돼"라고 한 경우만 생략
- 그 외 모든 경우 **자동 실행 필수**

### 사전 확인 규칙
다음 경우 **반드시 사용자에게 먼저 물어보고** 진행:
- ✅ 작업 내용이 불명확하거나 모호한 경우
- ✅ 시간이 5분 이상 걸릴 것으로 예상되는 작업
- ✅ 데이터베이스 스키마 변경이 필요한 경우
- ✅ 기존 기능을 크게 변경하는 경우
- ✅ 외부 API 호출이나 비용이 발생하는 작업

**물어보는 형식**:
```
이 작업은 [예상 시간/영향 범위]가 필요합니다.
진행하시겠습니까?
- 옵션 1: [방법 A]
- 옵션 2: [방법 B]
```

---

## 📋 버전 일관성 확인

다음 파일들의 버전이 **모두 동일**해야 합니다:
- `CHANGELOG.md` (최상단 항목)
- `frontend/src/App.jsx` (Footer)
- Git 태그 (선택사항)

### 버전 확인 명령어
```bash
# CHANGELOG 버전 확인
head -5 CHANGELOG.md

# Footer 버전 확인
grep "Ver 3" frontend/src/App.jsx

# Git 태그 확인
git describe --tags

# 최신 커밋 확인
git log -1
```

---

## 🔧 개발 환경 설정

### 필수 소프트웨어
- **Python**: 3.12 이상
- **Node.js**: v18.20.8
- **MySQL/MariaDB**: 연결 정보
  - Host: 114.108.180.228:3306
  - Database: mywork_01
  - User: blueeye
  - Password: blueeye0037!

### Python 가상환경
```bash
cd /home/blue/blue/my_project/money/backend
source venv/bin/activate
```

### 환경 변수 (.bashrc)
```bash
# Context7 MCP API 키
export CONTEXT7_API_KEY=ctx7sk-2f719444-158c-4294-aeff-548e188dbe3c
export MCP_CONFIG_PATH=~/.config/mcp/config.json

# 프로젝트 alias
alias web-run100='/home/blue/blue/my_project/money/deploy.sh'
```

### MCP 서버 설정
- **설정 파일**: `~/.gemini/antigravity/mcp_config.json`
- **전역 설정**: `~/.config/mcp/config.json`
- **Cursor 설정**: `~/.cursor/mcp.json`

---

## 🚀 배포 검증

### 배포 후 반드시 확인
1. ✅ 웹사이트 접속: `http://localhost:5000` 또는 배포 URL
2. ✅ Footer 버전 일치 확인
3. ✅ 빌드 시간이 최신인지 확인
4. ✅ 콘솔 에러 없는지 확인 (F12)
5. ✅ 주요 기능 동작 확인

### 자동화 체크리스트
```bash
# 버전 확인
grep "Ver 3" frontend/src/App.jsx  # Footer 버전
head -5 CHANGELOG.md               # CHANGELOG 최신 항목

# 빌드 확인
ls -lh frontend/dist/assets/       # 빌드 파일 생성 확인

# Git 상태
git log -1                         # 최신 커밋 확인
git status                         # 작업 디렉토리 상태

# 서버 상태
sudo systemctl status money-backend
sudo systemctl status money-frontend
```

---

## 🔥 배포 실패 시 대응

### Frontend 빌드 실패
```bash
# 1. node_modules 재설치
cd frontend
rm -rf node_modules package-lock.json
npm install
npm run build
```

### Git 푸시 실패
```bash
# 1. Remote 상태 확인
git pull origin main --rebase

# 2. 충돌 해결 후
git add .
git rebase --continue
git push origin main
```

### 백엔드 재시작 실패
```bash
# 1. 상태 확인
sudo systemctl status money-backend

# 2. 로그 확인
journalctl -u money-backend -n 50

# 3. 강제 재시작
sudo systemctl restart money-backend --force
```

### sudo 비밀번호
```
blueeye0037!
```

---

## 📚 개발 규칙

### 데이터 무결성 보장
1. **Frontend-Backend 데이터 계약**: Frontend가 참조하는 키(key)는 Backend에서 항상 존재해야 합니다.
   - 예: `market.details.soxl.current_price`가 필요하면 `soxl` 객체는 항상 `current_price` 필드를 가져야 합니다.
   - **Check**: `KeyError`나 `undefined` 에러 방지를 위해 초기화 시 모든 키를 기본값으로 설정하세요.

### 코드 품질
- 간결하게 작성
- 추측하지 말고 모르면 물어보기
- 불필요하게 쿼터를 소진하지 말 것

### 지침 관리
- 모델이 바뀌면 무조건 지침 전체 숙지
- 마지막에 사용한 모델을 기억
- 지침을 사용자가 바꾸거나 추가할 때 반드시 지침 전체를 다시 읽고 반영

---

## 🎯 작업 완료 보고 형식

```markdown
## ✅ [작업명] 완료

### 주요 변경사항:
- [변경 1]
- [변경 2]

### 자동 실행 완료:
✅ CHANGELOG.md 업데이트 (v3.2.2)
✅ Footer 버전 업데이트 (v3.2.2)
✅ Frontend 빌드
✅ Git 커밋 및 푸시
✅ 웹 배포
✅ 요청사항 DB 등록

### 버전 정보:
- 버전: v3.2.2
- 빌드 시간: 2026-01-04 18:45
- Git 커밋: abc1234

빌드가 완료되어 바로 확인하실 수 있습니다! 🚀
```

---

## 📖 관련 문서

### 필수 참조 문서
- `🚀_시작하기_필독.md`: 프로젝트 시작 가이드
- `CHANGELOG.md`: 사용자 대상 변경 이력
- `진행사항.md`: 상세 개발 이력
- `실전_매매_전략_지침.md`: 비즈니스 로직 규칙
- `해외주식_데이터수집_지침.md`: 데이터 소스 규칙
- `DEPLOY_GUIDE_UBUNTU.md`: 우분투 배포 가이드

### MCP 관련 문서
- `.docs/MCP/MCP_설정_완료_가이드.md`: MCP 서버 설정 상세
- `.docs/MCP/MCP_활용_최적화_지침.md`: MCP 활용 베스트 프랙티스
- `.docs/MCP/MCP_빠른참조.md`: 빠른 참조 가이드

---

**최종 업데이트**: 2026-01-04 18:45  
**버전**: 1.0 (통합본)  
**중요도**: ⭐⭐⭐⭐⭐ (최우선)

> 💡 **중요**: 이 문서의 모든 규칙은 반드시 준수해야 합니다!
