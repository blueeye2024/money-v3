# 배포 및 Git 업데이트 환경설정 가이드 (환경설정.md)

이 문서는 프로젝트의 배포(Publish) 및 Git 업데이트 시 반드시 준수해야 하는 규칙과 절차를 정의합니다. **AI 에이전트 및 개발자는 이 지침을 항상 따라야 합니다.**

---

## 📦 표준 배포 프로세스 (Standard Deployment Process)

### 업데이트가 발생하면 **반드시** 다음 순서를 따라 진행합니다:

### 1단계: 버전 결정
- **Minor Update** (기능 추가, 버그 수정): 0.0.1 증가 (예: 2.4.4 → 2.4.5)
- **Major Update** (대규모 변경): 0.1.0 증가 (예: 2.4.5 → 2.5.0)

### 2단계: Footer 버전 및 빌드 시간 업데이트
**파일**: `frontend/src/App.jsx`

```javascript
// Line 239 수정
<p>&copy; 2024 Cheongan FinTech. All rights reserved. Ver 2.X.X (Build: YYYY-MM-DD HH:mm)</p>
```

**형식**:
- 버전: `Ver 2.X.X`
- 빌드 시간: 현재 한국 시간 `YYYY-MM-DD HH:mm` (예: `2026-01-02 13:44`)

### 3단계: CHANGELOG 업데이트
**파일**: `CHANGELOG.md`

```markdown
## [Ver 2.X.X] - YYYY-MM-DD

### 추가 (Added)
- **기능 이름**: 설명

### 수정 (Fixed)
- **버그/개선**: 설명

### 변경 (Changed)
- **변경사항**: 설명
```

**주의**: 최신 버전이 가장 위에 오도록 작성

### 4단계: Frontend 빌드
```bash
cd /home/blue/blue/my_project/money/frontend
npm run build
```

**검증**: 
- `dist/` 디렉토리 생성 확인
- 빌드 시간 2-3초 내 완료

### 5단계: Git 커밋 및 푸시
```bash
cd /home/blue/blue/my_project/money

# Stage all changes
git add -A

# Commit with version message
git commit -m "Ver 2.X.X: [변경사항 요약]

- Add: [추가된 기능]
- Fix: [수정된 버그]
- Update: Footer version to 2.X.X (Build: YYYY-MM-DD HH:mm)"

# Push to remote
git push origin main
```

**커밋 메시지 형식**:
- 제목: `Ver 2.X.X: [한 줄 요약]`
- 본문: 변경사항 Bullet Point 형식

---

## 🤖 AI 에이전트 자동화 규칙

사용자가 **"업데이트가 되면 git에 버전 올리고..."**라고 요청하면:

### 필수 실행 순서
1. ✅ 버전 번호 결정 (기존 버전 +0.0.1)
2. ✅ `frontend/src/App.jsx` Footer 수정 (버전 + 빌드 시간)
3. ✅ `CHANGELOG.md` 최상단에 새 버전 항목 추가
4. ✅ `npm run build` 실행 (frontend 디렉토리)
5. ✅ Git add, commit, push (위 형식 준수)
6. ✅ **요청사항 DB 등록** (POST /api/requests)

### 6단계: 요청사항 자동 등록
배포 완료 후 사용자 요청을 DB에 기록합니다.

```bash
curl -X POST http://localhost:9100/api/requests \
  -H "Content-Type: application/json" \
  -d '{
    "request_text": "[사용자가 요청한 원문]",
    "ai_interpretation": "[요청 요약: 핵심 업데이트 내용]",
    "implementation_details": "[상세 구현 내역: 파일, 라인, 변경사항]",
    "status": "completed"
  }'
```

**필수 항목**:
- `request_text`: 사용자의 원본 요청 내용 (그대로 기록)
- `ai_interpretation`: AI가 이해한 요청 요약
- `implementation_details`: 실제 구현한 파일 및 코드 변경 상세
- `status`: "completed" (완료) 또는 "pending" (진행중)

**예시**:
```json
{
  "request_text": "업데이트가 되면 git에 버전 올리고 웹 카피라이터도 버전 올리고...",
  "ai_interpretation": "배포 시 자동으로 버전 관리 및 Git 업데이트",
  "implementation_details": "## 구현 내역\n- frontend/src/App.jsx: Footer 버전 업데이트\n- CHANGELOG.md: Ver 2.X.X 항목 추가\n- 환경설정.md: 배포 프로세스 문서화",
  "status": "completed"
}
```

### 자동화 체크리스트
```bash
# 버전 확인
grep "Ver 2" frontend/src/App.jsx  # Footer 버전
head -5 CHANGELOG.md               # CHANGELOG 최신 항목

# 빌드 확인
ls -lh frontend/dist/assets/       # 빌드 파일 생성 확인

# Git 상태
git log -1                         # 최신 커밋 확인
git push origin main               # 푸시 성공 확인
```

---

## 📋 추가 규칙 (Additional Rules)

### 1. 버전 일관성
다음 파일들의 버전이 **모두 동일**해야 합니다:
- `frontend/src/App.jsx` (Footer)
- `CHANGELOG.md` (최상단 항목)
- `진행사항.md` (버전 히스토리)

### 2. Git 태그 (선택사항)
Major 업데이트 시:
```bash
git tag -a v2.5.0 -m "Version 2.5.0: Major features"
git push origin v2.5.0
```

### 3. 배포 검증
**배포 후 반드시 확인**:
1. ✅ 웹사이트 접속: http://money.mysmartgate.kr/
2. ✅ Footer 버전 일치 확인
3. ✅ 빌드 시간이 최신인지 확인
4. ✅ 콘솔 에러 없는지 확인 (F12)

### 4. 긴급 배포 (Hotfix)
Backend만 수정한 경우:
```bash
# Backend 재시작만
sudo systemctl restart cheongan-backend

# Git 커밋 (Frontend 빌드 불필요)
git add backend/
git commit -m "Hotfix: [문제 설명]"
git push origin main
```

---

## 🔥 배포 실패 시 대응

### Frontend 빌드 실패
```bash
# 1. node_modules 재설치
cd frontend
rm -rf node_modules package-lock.json
npm install
npm run build
```

### Git 푸시 실패
```bash
# 1. Remote 상태 확인
git pull origin main --rebase

# 2. 충돌 해결 후
git add .
git rebase --continue
git push origin main
```

### 백엔드 재시작 실패
```bash
# 1. 상태 확인
sudo systemctl status cheongan-backend

# 2. 로그 확인
journalctl -u cheongan-backend -n 50

# 3. 강제 재시작
sudo systemctl restart cheongan-backend --force
```

---

### 개발 규칙: 데이터 무결성 보장
1. **Frontend-Backend 데이터 계약**: Frontend가 참조하는 키(key)는 Backend에서 항상 존재해야 합니다.
   - 예: `market.details.soxl.current_price`가 필요하면 `soxl` 객체는 항상 `current_price` 필드를 가져야 합니다. (값은 0이나 null일 수 있어도 키는 존재해야 함)
   - **Check**: `KeyError`나 `undefined` 에러 방지를 위해 초기화 시 모든 키를 기본값으로 설정하세요.

### 기타 참고 자료
- `진행사항.md`: 상세 개발 이력
- `CHANGELOG.md`: 사용자 대상 변경 이력
- `실전_매매_전략_지침.md`: 비즈니스 로직 규칙
- `해외주식_데이터수집_지침.md`: 데이터 소스 규칙

---

## 📚 필수 사항 : 꼭 읽고 반영할것
- `진행사항.md`: 상세 개발 이력
- `CHANGELOG.md`: 사용자 대상 변경 이력
- `실전_매매_전략_지침.md`: 비즈니스 로직 규칙
- `해외주식_데이터수집_지침.md`: 데이터 소스 규칙
- "간결하게 대답해", "추측하지 말고 모르면 물어봐"
- "불필요하게 쿼터를 소진하지 말것."
- 모델이 바뀌면 무조건 지침 전체 숙지 할것" , "마지막에 사용한 모델을 기억해."
- "지침을 사용자가 바꾸거나 추가할때 반드시 지침 전체를 다시 읽고 반영할것."
- sudo 터미널 실행 비밀번호 : blueeye0037!

---

## 🤖 AI 에이전트 필수 작업 규칙 (절대 준수)

### 1. 언어 사용 규칙
- **모든 설명과 응답은 한국어로 작성**
- 코드 주석도 가능한 한국어 사용
- 기술 용어는 한글(영문) 병기 가능 (예: 배포(Deploy))

### 2. 사전 확인 규칙
다음 경우 **반드시 사용자에게 먼저 물어보고** 진행:
- ✅ 작업 내용이 불명확하거나 모호한 경우
- ✅ 시간이 5분 이상 걸릴 것으로 예상되는 작업
- ✅ 데이터베이스 스키마 변경이 필요한 경우
- ✅ 기존 기능을 크게 변경하는 경우
- ✅ 외부 API 호출이나 비용이 발생하는 작업

**물어보는 형식**:
```
이 작업은 [예상 시간/영향 범위]가 필요합니다.
진행하시겠습니까?
- 옵션 1: [방법 A]
- 옵션 2: [방법 B]
```

### 3. 작업 완료 후 자동 실행 규칙 (절대 준수)
코드 수정이 완료되면 **반드시 자동으로** 다음을 실행:

#### 3-1. Frontend 빌드
```bash
cd /home/blue/blue/my_project/money/frontend
npm run build
```

#### 3-2. Git 업데이트
```bash
cd /home/blue/blue/my_project/money
git add -A
git commit -m "[작업 내용 요약]"
git push origin main
```

#### 3-3. 요청사항 DB 등록
```bash
curl -X POST http://localhost:9100/api/requests \
  -H "Content-Type: application/json" \
  -d '{
    "request_text": "[사용자 원문]",
    "ai_interpretation": "[요청 요약]",
    "implementation_details": "[구현 상세]",
    "status": "completed"
  }'
```

**예외 사항**:
- 사용자가 명시적으로 "배포하지 마" 또는 "Git 업데이트 안 해도 돼"라고 한 경우만 생략
- 그 외 모든 경우 **자동 실행 필수**

### 4. 작업 완료 보고 형식
```markdown
## ✅ [작업명] 완료

### 주요 변경사항:
- [변경 1]
- [변경 2]

### 자동 실행 완료:
✅ Frontend 빌드
✅ Git 커밋 및 푸시
✅ 요청사항 DB 등록

빌드가 완료되어 바로 확인하실 수 있습니다! 🚀
```

**마지막 업데이트**: 2026-01-03 21:50 (AI 에이전트 작업 규칙 강화)
